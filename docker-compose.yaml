version: '3.8'

services:
  wasm:
    build: .
    image: acrcredibil.azurecr.io/demo/wasmgrid
    platform: linux/amd64
    environment:
      - RUST_LOG=runtime=debug,services=trace
    ports:
      - 8080:8080
    # volumes:
    #   serialized wasmtime component (pre-compiled wasm)
    #   - ./keyvalue.bin:/app.wasm
    #   command: ["/app/wasmgrid", "run", "/app.wasm"]
    volumes:
      # standard wasm file
      - ./target/wasm32-wasip2/release/keyvalue.wasm:/app.wasm
    command: ["/app/wasmgrid", "run", "--compile", "/app.wasm"]